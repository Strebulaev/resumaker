<!-- Файл: src/app/components/Pages/ai-config-modal/ai-config-modal.component.html -->
<div class="ai-config-modal">
  <div class="providers-grid">
    <div *ngFor="let provider of providers" 
         class="provider-card"
         [class.configured]="provider.isConfigured"
         [class.current]="isCurrentProvider(provider.id)"
         [class.default-provider]="provider.isDefault">
      
      <div class="provider-header">
        <h3>{{ provider.name }}</h3>
        <div class="provider-status">
          <span *ngIf="provider.isDefault" class="status-badge default">
            ⚡ По умолчанию
          </span>
          <span *ngIf="provider.isConfigured" class="status-badge configured">
            ✓ Настроен
          </span>
          <span *ngIf="isCurrentProvider(provider.id)" class="status-badge active-text">
            ● Активный
          </span>
        </div>
      </div>

      <div class="provider-config" *ngIf="editingProvider === provider.id">
        <div class="config-field">
          <label>API Key:</label>
          <input type="password" 
                 [(ngModel)]="provider.apiKey"
                 [placeholder]="provider.isDefault ? 'Автоматически из конфига' : 'Введите ваш API ключ'"
                 [disabled]="!!(provider.isDefault && provider.isConfigured)">
        </div>
        
        <div class="config-field">
          <label>Base URL:</label>
          <input type="text" 
                 [(ngModel)]="provider.baseUrl"
                 [placeholder]="provider.baseUrl"
                 [disabled]="!!provider.isDefault">
        </div>

        <div class="config-actions">
          <button pButton 
                  label="Сохранить" 
                  (click)="saveProviderConfig(provider)"
                  class="p-button-success"
                  [disabled]="!!provider.isDefault">
          </button>
          <button pButton 
                  label="Отмена" 
                  (click)="cancelEdit()"
                  class="p-button-secondary">
          </button>
          <button *ngIf="provider.isConfigured"
                  pButton 
                  label="Проверить подключение"
                  (click)="testConnection(provider.id)"
                  class="p-button-info">
          </button>
        </div>
      </div>

      <div class="provider-actions" *ngIf="editingProvider !== provider.id">
        <button pButton 
                [label]="provider.isConfigured ? 'Изменить' : 'Настроить'"
                (click)="editProvider(provider.id)"
                class="p-button-outlined"
                [disabled]="!!(provider.isDefault && provider.isConfigured)">
        </button>
        
        <button *ngIf="provider.isConfigured && !isCurrentProvider(provider.id)"
                pButton 
                label="Использовать"
                (click)="setCurrentProvider(provider.id)"
                class="p-button-success">
        </button>

        <!-- Кнопка подключения для Together AI -->
        <button *ngIf="provider.isDefault && !provider.isConfigured"
                pButton 
                label="Подключить"
                (click)="connectTogetherAI()"
                class="p-button-help">
          <i class="pi pi-plug"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Блок с общей информацией -->
  <div class="connection-help">
    <h4>Решение проблем с подключением:</h4>
    <ul>
      <li>✅ Проверьте правильность API ключа</li>
      <li>✅ Убедитесь, что API ключ имеет необходимые права доступа</li>
      <li>✅ Для Together AI - ключ автоматически загружается из конфигурации</li>
      <li>❌ CORS ошибки требуют настройки серверной части</li>
    </ul>
  </div>
</div>