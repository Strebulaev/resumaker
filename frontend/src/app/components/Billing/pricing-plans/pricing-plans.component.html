<div class="pricing-container">
  <div class="pricing-header">
    <h1 class="pricing-title">{{ 'BILLING.PRICING_TITLE' | translate }}</h1>
    <p class="pricing-subtitle">{{ 'BILLING.PRICING_SUBTITLE' | translate }}</p>
  </div>

  <!-- Debug information -->
  <div *ngIf="plans.length === 0" class="debug-info">
    <p>{{ 'BILLING.NO_PLANS_LOADED' | translate }}</p>
  </div>

  <div class="plans-grid">
    <p-card *ngFor="let plan of plans"
            [class]="'plan-card' + (plan.popular ? ' popular' : '')"
            [header]="plan.name">

      <div class="plan-price">
        <span class="price-amount">{{ plan.price === 0 ? ('BILLING.FREE' | translate) : (plan.price + ' ₽') }}</span>
        <span *ngIf="plan.price > 0" class="price-period">{{ 'BILLING.PER_MONTH' | translate }}</span>
      </div>

      <p class="plan-description">{{ plan.description }}</p>

      <ul class="plan-features">
        <li *ngFor="let feature of plan.features">{{ feature }}</li>
      </ul>

      <div class="plan-limits">
        <div class="limit-item">
          <span class="limit-label">{{ 'BILLING.RESUME_GENERATIONS' | translate }}:</span>
          <span class="limit-value">
            {{ plan.dailyLimits.resumeGenerations === -1 ? ('BILLING.UNLIMITED' | translate) : plan.dailyLimits.resumeGenerations }}{{ 'BILLING.PER_DAY' | translate }}
          </span>
        </div>
        <div class="limit-item">
          <span class="limit-label">{{ 'BILLING.COVER_LETTERS' | translate }}:</span>
          <span class="limit-value">
            {{ plan.dailyLimits.coverLetters === -1 ? ('BILLING.UNLIMITED' | translate) : plan.dailyLimits.coverLetters }}{{ 'BILLING.PER_DAY' | translate }}
          </span>
        </div>
        <div class="limit-item">
          <span class="limit-label">{{ 'BILLING.INTERVIEW_PLANS' | translate }}:</span>
          <span class="limit-value">
            {{ plan.dailyLimits.interviewPlans === -1 ? ('BILLING.UNLIMITED' | translate) : plan.dailyLimits.interviewPlans }}{{ 'BILLING.PER_DAY' | translate }}
          </span>
        </div>
        <div class="limit-item">
          <span class="limit-label">GitHub {{ 'BILLING.RESUME_GENERATIONS' | translate | lowercase }}:</span>
          <span class="limit-value">
            {{ plan.dailyLimits.githubAnalyses === -1 ? ('BILLING.UNLIMITED' | translate) : plan.dailyLimits.githubAnalyses }}/month
          </span>
        </div>
      </div>

      <button pButton
              [label]="getButtonLabel(plan)"
              class="plan-button"
              [loading]="isLoading"
              (click)="selectPlan(plan)">
      </button>

      <div *ngIf="plan.popular" class="popular-badge">
        {{ 'BILLING.POPULAR_CHOICE' | translate }}
      </div>
    </p-card>
  </div>

  <!-- Диалог оплаты -->
  <p-dialog [(visible)]="showPaymentDialog"
            [modal]="true"
            class="payment-dialog"
            (onHide)="closeDialog()">

    <ng-template pTemplate="header">
      <span class="dialog-header">{{ 'BILLING.PAYMENT_DIALOG_TITLE' | translate }} {{ selectedPlan?.name }}</span>
    </ng-template>

    <div *ngIf="selectedPlan" class="dialog-content">
      <p>{{ 'BILLING.PAYMENT_SUMMARY' | translate:{planName: selectedPlan.name} }}</p>
      <p>{{ 'BILLING.COST' | translate }} <strong>{{ selectedPlan.price }} ₽</strong></p>
      <p>{{ 'BILLING.PAYMENT_INFO' | translate }}</p>
    </div>

    <ng-template pTemplate="footer">
      <button pButton
              [label]="'BUTTON.CANCEL' | translate"
              class="p-button-text"
              (click)="closeDialog()"></button>
      <button pButton
              [label]="'BILLING.PROCEED_TO_PAYMENT' | translate"
              [loading]="isLoading"
              (click)="processPayment()"
              class="p-button-primary"></button>
    </ng-template>
  </p-dialog>
</div>